---
- hosts: all
  gather_facts: no
  connection: local
  tasks:
  - include_vars: "{{inventory_dir}}/host_vars/{{inventory_hostname_short}}.yml"
  - include_vars: "services.yml"

#>>>>>>>>>>>>>>>>>>>>>>>>>>  Template Creation  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>#
#  - name: Generated configuration fils with Block Markers
#    template: src=Generate-Configurations.j2 dest=configurations/{{inventory_hostname_short}}.cfg
 
  - name: Delete Assemble directory
    file:
      path: ./configurations/assemble
      state: absent
      mode: '0755'
    run_once: True

  - name: Create Assemble directory
    file:
      path: ./configurations/assemble
      state: directory
      mode: '0755'
    run_once: True

#<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>#
  - name: Add users login details
    blockinfile: 
      create: yes
      dest: ./configurations/assemble/10_{{inventory_hostname_short}}.cfg
      marker: ""
      block: |
         username {{user.username}} password 0 {{user.password}}
    loop: "{{ Users }}"
    loop_control:
      loop_var: user
      label: Adding {{user.username}} from group {{group_names}}

  - name: Add Banner to configuration Files
    blockinfile: 
      create: yes
      dest: ./configurations/assemble/90_{{inventory_hostname_short}}.cfg
      marker: ""
      block: |
        banner login
        This configuration was generated by ansible for node {{nodeid}}.

  - name: Assemble configuration snippets
    assemble:
      src: ./configurations/assemble/
      dest: ./configurations/{{inventory_hostname_short}}.cfg
      regexp: "{{inventory_hostname_short}}"                
        
##<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>#
#- hosts: west
#  gather_facts: no
#  connection: local
#  tasks:
#  - include_vars: "{{inventory_dir}}/host_vars/{{inventory_hostname_short}}.yml"
#  - include_vars: "services.yml"
#
#  - name: Add IOS Loopback Interfaces
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Loopback {{ nodeid }}"
#      block: |
#        interface Loopback 0
#        ip address {{( loopbacks | ipaddr (nodeid) | ipaddr ('address') )}}  255.255.255.255
#
#  - name: Add IOS SNMP configuration
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding IOS SNMP {{ nodeid }}"
#      block: |
#         ip access-list standard NMS-STATIONS
#          permit {{NMS1}}
#          permit {{NMS2}}
#         !
#         snmp-server community public RO NMS-STATIONS
#         snmp-server community private RW NMS-STATIONS
#         snmp-server chassis-id 
#         snmp-server host {{SNMP1}} version 2c public 
#         snmp-server host {{SNMP2}} version 2c public 
#
#  - name: Add IOS Interfaces to configuration Files
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Interfaces {{ nodeid }}{{count}}"
#      block: |
#         interface {{link.port}}
#          ip address {{link.ip}} {{link.mask}}
#          description {{link.description}}
#          ip ospf network point-to-point
#          ip ospf 10 area 0
#          duplex auto
#          speed auto
#          media-type rj45
#    loop: "{{ links }}"
#    loop_control:
#      loop_var: link
#      label: "Iteration {{count}} Adding {{link.description}}"     
#      index_var: count
#
#  - name: Add IOS Routing
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Routing {{ nodeid }}"
#      block: |
#         router ospf 10
#          router-id {{( loopbacks | ipaddr (nodeid) | ipaddr ('address') )}}
#          default-metric 1000
#          network {{( loopbacks | ipaddr (nodeid) | ipaddr ('address') )}} 0.0.0.0 area 0
#
#  
##<><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><><>#
#
#- hosts: east
#  gather_facts: no
#  connection: local
#  tasks:
#  - include_vars: "{{inventory_dir}}/host_vars/{{inventory_hostname_short}}.yml"
#  - include_vars: "services.yml"
#
#  - name: Add XR Loopback Interfaces to configuration Files
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Loopback {{ nodeid }}"
#      block: |
#        interface Loopback 0
#        ipv4 address {{( loopbacks | ipaddr (nodeid) | ipaddr ('address') )}}  255.255.255.255
#
#  - name: Add XR SNMP configuration
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding XR SNMP {{ nodeid }}"
#      block: |
#         snmp-server host {{SNMP1}} traps version 2c public
#         snmp-server host {{SNMP2}} traps version 2c public
#         snmp-server community public RO IPv4 NMS-STATIONS
#         snmp-server community private RW IPv4 NMS-STATIONS
#         !
#         ipv4 access-list NMS-STATIONS
#          10 permit ipv4 host {{NMS1}} any
#          20 permit ipv4 host {{NMS2}} any
#
#  - name: Add XR Interfaces to configuration Files
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Interfaces {{ nodeid }}{{count}}"
#      block: |
#         interface {{link.port}}
#          ipv4 address {{link.ip}} {{link.mask}}
#          description {{link.description}}
#    loop: "{{ links }}"
#    loop_control:
#      loop_var: link
#      label: "Iteration {{count}} Adding {{link.description}}" 
#      index_var: count      
#
#  - name: Add XR routing
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding Routing {{ nodeid }}"
#      block: |
#         router ospf 10
#          router-id {{( loopbacks | ipaddr (nodeid) | ipaddr ('address') )}}
#          default-metric 1000
#          area 0
#           loopback stub-network enable
#           interface Loopback 0
#          !
#
#  - name: Add XR Routed Interfaces
#    blockinfile: 
#      dest: ./configurations/{{inventory_hostname_short}}.cfg
#      marker: "! {mark} adding XR Routed Interfaces {{ nodeid }}{{count}}"
#      block: |
#           interface {{link.port}}
#           network point-to-point
#    loop: "{{ links }}"
#    loop_control:
#      loop_var: link
#      label: "Adding {{link.port}}" 
#      index_var: count     
#     
#...